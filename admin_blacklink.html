<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Painel Admin ‚Ä¢ CosaNostra BlackLink</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
    body {
        margin: 0;
        background: radial-gradient(circle at top, #140b33, #000);
        color: #fff;
        font-family: "Inter", sans-serif;
    }

    .container {
        max-width: 700px;
        margin: 40px auto;
        padding: 25px;
        background: rgba(5, 5, 5, 0.92);
        border-radius: 18px;
        border: 1px solid #3a304f;
        box-shadow: 0 0 25px rgba(0,0,0,0.9);
    }

    h1 {
        font-family: "Playfair Display", serif;
        text-align: center;
        font-size: 32px;
        color: #f1d17d;
        margin-bottom: 5px;
    }

    .subtitle {
        text-align: center;
        color: #aaa;
        margin-bottom: 25px;
    }

    label {
        display: block;
        margin-top: 15px;
        margin-bottom: 5px;
        font-size: 14px;
        color: #ddd;
    }

    input {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #333;
        background: #111;
        color: #fff;
        font-size: 15px;
        outline: none;
    }

    input:focus {
        border-color: #f1d17d;
    }

    .btn {
        margin-top: 20px;
        padding: 12px;
        width: 100%;
        border-radius: 10px;
        border: none;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.25s;
    }

    .btn-save {
        background: #f1d17d;
        color: #000;
    }

    .btn-save:hover {
        opacity: 0.9;
    }

    .status {
        margin-top: 15px;
        font-size: 14px;
        text-align: center;
    }

    .status.ok {
        color: #00ff88;
    }

    .status.err {
        color: #ff5555;
    }

    .preview {
        margin-top: 25px;
        border-top: 1px solid #333;
        padding-top: 15px;
        font-size: 14px;
        color: #bbb;
    }

    .preview-img {
        margin-top: 10px;
        max-width: 250px;
        border-radius: 10px;
        border: 1px solid #444;
    }
</style>
</head>

<body>

<div class="container">

    <h1>Painel Admin ‚Ä¢ BlackLink</h1>
    <div class="subtitle">
        Controle central do <b>Destaque do Dia</b> exibido em todos os BlackLinks.
    </div>

    <label for="name">Nome do produto</label>
    <input id="name" type="text" placeholder="Ex: Fone Basike IPX5 ‚Äî 100h bateria">

    <label for="price">Pre√ßo</label>
    <input id="price" type="text" placeholder="Ex: R$ 86,33">

    <label for="image_url">URL da imagem</label>
    <input id="image_url" type="text" placeholder="Cole aqui a URL da imagem do produto">

    <label for="link">Link de compra (afiliado)</label>
    <input id="link" type="text" placeholder="Cole aqui seu link do Mercado Livre / outro">

    <button class="btn btn-save" onclick="salvarProduto()">Salvar produto do dia</button>

    <div id="status" class="status"></div>

    <div class="preview">
        <div>Pr√©-visualiza√ß√£o r√°pida:</div>
        <div id="preview-name" style="margin-top:5px;"></div>
        <div id="preview-price"></div>
        <img id="preview-img" class="preview-img" src="" style="display:none;">
        <div id="preview-link" style="margin-top:8px;font-size:13px;"></div>
    </div>

</div>

<script>
const API_BASE = "http://localhost:8000/api/product-of-the-day/";

async function carregarProduto() {
    const statusEl = document.getElementById("status");
    statusEl.textContent = "Carregando produto atual...";
    statusEl.className = "status";

    try {
        const res = await fetch(API_BASE);
        if (!res.ok) throw new Error("Falha ao buscar produto");
        const data = await res.json();

        document.getElementById("name").value = data.name || "";
        document.getElementById("price").value = data.price || "";
        document.getElementById("image_url").value = data.image_url || "";
        document.getElementById("link").value = data.link || "";

        atualizarPreview();

        statusEl.textContent = "Produto carregado com sucesso.";
        statusEl.className = "status ok";
    } catch (e) {
        statusEl.textContent = "Erro ao carregar produto: " + e.message;
        statusEl.className = "status err";
    }
}

function atualizarPreview() {
    const name = document.getElementById("name").value;
    const price = document.getElementById("price").value;
    const image_url = document.getElementById("image_url").value;
    const link = document.getElementById("link").value;

    document.getElementById("preview-name").textContent = name ? "üî• " + name : "";
    document.getElementById("preview-price").textContent = price || "";

    const imgEl = document.getElementById("preview-img");
    if (image_url) {
        imgEl.src = image_url;
        imgEl.style.display = "block";
    } else {
        imgEl.style.display = "none";
    }

    document.getElementById("preview-link").textContent = link ? link : "";
}

async function salvarProduto() {
    const statusEl = document.getElementById("status");
    statusEl.textContent = "Salvando...";
    statusEl.className = "status";

    const payload = {
        name: document.getElementById("name").value.trim(),
        price: document.getElementById("price").value.trim(),
        image_url: document.getElementById("image_url").value.trim(),
        link: document.getElementById("link").value.trim()
    };

    if (!payload.name || !payload.link) {
        statusEl.textContent = "Nome e link s√£o obrigat√≥rios.";
        statusEl.className = "status err";
        return;
    }

    try {
        const res = await fetch(API_BASE, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (!res.ok) {
            let msg = "Erro ao salvar.";
            try {
                const err = await res.json();
                msg += " " + (err.detail || "");
            } catch {}
            throw new Error(msg);
        }

        const data = await res.json();
        statusEl.textContent = "Produto atualizado com sucesso.";
        statusEl.className = "status ok";

        document.getElementById("name").value = data.name || "";
        document.getElementById("price").value = data.price || "";
        document.getElementById("image_url").value = data.image_url || "";
        document.getElementById("link").value = data.link || "";

        atualizarPreview();
    } catch (e) {
        statusEl.textContent = e.message;
        statusEl.className = "status err";
    }
}

document.getElementById("name").addEventListener("input", atualizarPreview);
document.getElementById("price").addEventListener("input", atualizarPreview);
document.getElementById("image_url").addEventListener("input", atualizarPreview);
document.getElementById("link").addEventListener("input", atualizarPreview);

document.addEventListener("DOMContentLoaded", carregarProduto);
</script>

</body>
</html>
